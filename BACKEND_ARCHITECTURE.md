# Архитектура Backend (FastAPI)

Для вывода сервиса "EduProgram GenAI" в продакшн рекомендуется архитектура на базе **FastAPI (Python)**. Ниже представлен список необходимых сервисов и модулей.

## 1. Сервис Аутентификации (Auth Service)
**Ответственность:** Безопасность и управление пользователями.
*   **Функции:**
    *   Регистрация, Вход (OAuth2 Password Bearer), Восстановление пароля.
    *   Генерация и валидация JWT (JSON Web Tokens).
    *   Управление ролями (Admin, User).
*   **Стек:** FastAPI, PostgreSQL, SQLAlchemy (или Tortoise ORM), Pydantic, Passlib (bcrypt), Python-Jose.

## 2. Сервис Образовательных Программ (Program Core Service)
**Ответственность:** Основная бизнес-логика приложения.
*   **Функции:**
    *   CRUD (Create, Read, Update, Delete) для программ.
    *   Хранение метаданных (название, часы, уровень) и контента разделов.
    *   Пагинация, сортировка и фильтрация списков программ.
*   **Стек:** FastAPI, PostgreSQL (реляционные данные) или MongoDB (если структура разделов часто меняется).

## 3. AI-Оркестратор (LLM Gateway)
**Ответственность:** Взаимодействие с GigaChat API.
*   **Функции:**
    *   **Хранение секретов:** API Key хранится только здесь, не передается на клиент.
    *   **Управление промптами:** Хранение шаблонов промптов в коде или БД.
    *   **Валидация:** Проверка ответов от нейросети (JSON Schema Validation) перед отправкой клиенту.
    *   **Очереди (опционально):** Если генерация долгая, использование Celery/Redis для фоновой обработки.
*   **Стек:** FastAPI, GigaChat SDK/HTTP API (Python), Redis (Rate Limiting).

## 4. Сервис Экспорта (Document Service)
*Примечание: Текущая реализация на клиенте (JS) хороша для интерактивности. Серверный вариант нужен для строгого соответствия ГОСТам.*
**Ответственность:** Генерация файлов.
*   **Функции:**
    *   Генерация .docx файлов на основе шаблонов.
    *   Конвертация в PDF (если требуется).
*   **Стек:** FastAPI, python-docx.

## 5. Инфраструктура (DevOps)
*   **Nginx/Traefik:** Reverse Proxy для маршрутизации запросов.
*   **Docker Compose:** Для локального запуска всех сервисов.
*   **PostgreSQL:** Основная база данных.
*   **Redis:** Кэширование сессий и лимитов запросов.

---

### Пример структуры проекта (Модульный Монолит)

```text
backend/
├── app/
│   ├── core/           # Конфигурация, безопасность, исключения
│   ├── db/             # Подключение к БД и миграции (Alembic)
│   ├── models/         # Pydantic схемы и ORM модели
│   ├── routers/        # API Endpoints
│   │   ├── auth.py
│   │   ├── programs.py
│   │   └── ai.py
│   ├── services/       # Бизнес-логика
│   │   ├── auth_service.py
│   │   ├── program_service.py
│   │   └── gigachat_service.py
│   └── main.py         # Точка входа
├── .env
├── docker-compose.yml
├── requirements.txt
└── alembic.ini
```
